(venv) D:\chat_service\backend>test_all_fixed.bat
Â­Æ’Ã„Ã–Â´Â©Ã… Testing Fixed Pydub FFmpeg Configuration
==========================================
Â­Æ’Ã´Ã¬ Current directory: D:\chat_service\backend
Â­Æ’Ã‰Ã¬ Activating virtual environment...

Â­Æ’Ã¶Âº Step 1: Configure pydub FFmpeg paths...
ğŸ™ï¸ Pydub FFmpeg Configuration Tool
==================================================
ğŸ”§ Configuring pydub to use FFmpeg...
âœ… Found FFmpeg at: C:\Users\NJ-25\scoop\apps\ffmpeg\7.1.1\bin\ffmpeg.exe
âœ… Found FFprobe at: C:\Users\NJ-25\scoop\apps\ffmpeg\7.1.1\bin\ffprobe.exe
D:\chat_service\backend\venv\Lib\site-packages\pydub\utils.py:170: RuntimeWarning: Couldn't find ffmpeg or avconv - defaulting to ffmpeg, but may not work
  warn("Couldn't find ffmpeg or avconv - defaulting to ffmpeg, but may not work", RuntimeWarning)
ğŸ”§ Configured pydub paths:
   converter: C:\Users\NJ-25\scoop\apps\ffmpeg\7.1.1\bin\ffmpeg.exe
   ffmpeg: C:\Users\NJ-25\scoop\apps\ffmpeg\7.1.1\bin\ffmpeg.exe
   ffprobe: C:\Users\NJ-25\scoop\apps\ffmpeg\7.1.1\bin\ffprobe.exe

ğŸ§ª Testing pydub with configured FFmpeg...
  ğŸ“€ Creating test audio...
  ğŸµ Exporting to MP3...
  âœ… MP3 export successful: 1506 bytes

ğŸ‰ SUCCESS! Pydub is now working with FFmpeg!

ğŸ“ To make this permanent, add this to your app startup:
   from pydub import AudioSegment
   AudioSegment.converter = r'C:\Users\NJ-25\scoop\apps\ffmpeg\7.1.1\bin\ffmpeg.exe'    
   AudioSegment.ffprobe = r'C:\Users\NJ-25\scoop\apps\ffmpeg\7.1.1\bin\ffprobe.exe'     

Â­Æ’ÂºÂ¬ Step 2: Test fixed pydub configuration...
ğŸ™ï¸ Fixed Pydub FFmpeg Test
========================================
ğŸ§ª Testing pydub with fixed FFmpeg configuration...
D:\chat_service\backend\venv\Lib\site-packages\pydub\utils.py:170: RuntimeWarning: Couldn't find ffmpeg or avconv - defaulting to ffmpeg, but may not work
  warn("Couldn't find ffmpeg or avconv - defaulting to ffmpeg, but may not work", RuntimeWarning)
  ğŸ“€ Creating test audio...
  ğŸ” FFmpeg configuration:
    converter: C:\Users\NJ-25\scoop\apps\ffmpeg\7.1.1\bin\ffmpeg.exe
    ffmpeg: C:\Users\NJ-25\scoop\apps\ffmpeg\7.1.1\bin\ffmpeg.exe
    ffprobe: C:\Users\NJ-25\scoop\apps\ffmpeg\7.1.1\bin\ffprobe.exe
  ğŸµ Exporting to MP3...
  âœ… MP3 export successful: 2551 bytes
  ğŸµ Exporting to WAV...
  âœ… WAV export successful: 22094 bytes
âœ… Pydub Fixed Configuration: PASSED

ğŸ§ª Testing audio processor with real conversion...
  ğŸ“€ Creating test WAV data...
  ğŸ” Created test audio: 16428 bytes
  ğŸ” Testing audio validation...
  ğŸ“Š Validation result: {'valid': True, 'format': 'wav', 'duration': 0.186, 'channels': 1, 'sample_rate': 44100, 'frame_count': 8192.0, 'sample_width': 2, 'file_size': 16428, 'bitrate': 706}
  ğŸ”„ Testing format conversion (WAV â†’ MP3)...
  âœ… Conversion successful!
    Input size: 16428 bytes
    Output size: 1581 bytes
    Compression ratio: 10.39
âœ… Audio Processor: PASSED

========================================
ğŸ“Š RESULTS: 2/2 tests passed
ğŸ‰ SUCCESS! Pydub FFmpeg configuration is working!
ğŸš€ No more FFmpeg warnings in your voice system!

Â­Æ’Ã„Â» Step 3: Run original test (should work now)...
ğŸ™ï¸ Phase 3 + FFmpeg Integration Test
==================================================
ğŸ”§ Testing pydub + FFmpeg integration...
D:\chat_service\backend\venv\Lib\site-packages\pydub\utils.py:170: RuntimeWarning: Couldn't find ffmpeg or avconv - defaulting to ffmpeg, but may not work
  warn("Couldn't find ffmpeg or avconv - defaulting to ffmpeg, but may not work", RuntimeWarning)
  ğŸ“€ Creating test audio...
  ğŸµ Exporting to MP3...
  âŒ pydub + FFmpeg test failed: [WinError 2] The system cannot find the file specified 
âŒ Pydub + FFmpeg test failed

ğŸ”§ Testing audio processor with FFmpeg...
  ğŸ“€ Creating test WAV data...
  ğŸ” Testing audio validation...
  âœ… Audio validation result: {'valid': False, 'error': 'Audio too short: 0.02s (min: 0.1s)'}
  ğŸ”„ Testing audio conversion...
  âœ… Audio conversion successful!
      Input size: 2092 bytes
      Output size: 539 bytes
      Compression ratio: 3.88126159554731

ğŸ”§ Testing voice services...
Token will not been saved to git credential helper. Pass `add_to_git_credential=True` if you want to set the git credential as well.
Token is valid (permission: fineGrained).
Your token has been saved to C:\Users\NJ-25\.cache\huggingface\token
Login successful
  âœ… All voice services imported successfully
  âœ… VoiceService has process_voice_message method
  âœ… STTService has transcribe_audio method
  âœ… TTSService has synthesize_speech method

==================================================
ğŸ“Š RESULTS: 2/3 tests passed
âš ï¸  Some tests had issues, but FFmpeg is working!
The voice system should still function properly.

Ã”Â£Â¿ All tests completed!
Press any key to continue . . .
